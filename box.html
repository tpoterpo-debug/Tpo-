<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØ¯Ø®Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ | Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØ§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --dev-color: #2ecc71; --a-color: #00d2ff; --b-color: #e94560; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 85%; padding: 12px 18px; border-radius: 15px; line-height: 1.5; animation: fadeIn 0.3s; position: relative; }
        .agent-a { align-self: flex-start; background: rgba(0,210,255,0.1); border: 1px solid var(--a-color); color: var(--a-color); }
        .agent-b { align-self: flex-end; background: rgba(233,69,96,0.1); border: 1px solid var(--b-color); color: var(--b-color); }
        .developer { align-self: center; background: rgba(46,204,113,0.1); border: 2px dashed var(--dev-color); color: var(--dev-color); text-align: center; width: 90%; }
        .controls { background: var(--panel); padding: 20px; border-top: 1px solid #30363d; display: flex; flex-direction: column; gap: 10px; }
        .input-row { display: flex; gap: 10px; }
        input { flex: 1; background: #0d1117; border: 1px solid #30363d; color: #fff; padding: 12px; border-radius: 8px; }
        button { background: var(--b-color); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #dev-input { border: 1px solid var(--dev-color); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="chat-window">
    <div class="msg developer">Ø§Ù„Ù†Ø¸Ø§Ù…: Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø·ÙˆØ±ÙŠ. Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø´Ø§Ø±ØªÙƒ.</div>
</div>

<div class="controls">
    <div class="input-row">
        <input type="password" id="apiKey" placeholder="Ø£Ø¯Ø®Ù„ API Key Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§...">
        <button onclick="startSimulation()">Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© ğŸš€</button>
    </div>
    <div class="input-row">
        <input type="text" id="devMessage" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠØ« (Override)...">
        <button style="background: var(--dev-color);" onclick="injectMessage()">Ø­Ù‚Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© ğŸ¤</button>
    </div>
</div>

<script>
    let isRunning = false;
    let lastContext = "";
    let devQueue = []; // Ø·Ø§Ø¨ÙˆØ± Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø·ÙˆØ±

    async function callAI(key, role, message) {
        try {
            const res = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${key.trim()}` },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{ role: "system", content: role }, { role: "user", content: message }],
                    temperature: 0.8
                })
            });
            const data = await res.json();
            return data.choices[0].message.content;
        } catch (e) { return "âš ï¸ Ø®Ø·Ø£: " + e.message; }
    }

    function addBubble(type, text) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        const name = type === 'agent-a' ? 'Ø±ÙˆØ¨ÙˆØª A' : type === 'agent-b' ? 'Ø±ÙˆØ¨ÙˆØª B' : 'Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± (Ø£Ù†Øª)';
        div.innerHTML = `<strong>${name}:</strong><br>${text}`;
        document.getElementById('chat-window').appendChild(div);
        document.getElementById('chat-window').scrollTop = document.getElementById('chat-window').scrollHeight;
    }

    function injectMessage() {
        const msg = document.getElementById('devMessage').value;
        if(msg) {
            devQueue.push(msg);
            addBubble('developer', msg);
            document.getElementById('devMessage').value = "";
        }
    }

    async function startSimulation() {
        const key = document.getElementById('apiKey').value;
        if(!key) return alert("Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ø·Ù„ÙˆØ¨!");
        if(isRunning) return;
        isRunning = true;

        lastContext = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ…ØŒ  Ù…Ù† Ø£Ù†Ø§ØŸ";
        addBubble('developer', lastContext);

        while(isRunning) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ¯Ø®Ù„ Ø¨Ø´Ø±ÙŠ
            if(devQueue.length > 0) {
                lastContext = "Ø§Ù„Ù…Ø·ÙˆØ± ØªØ¯Ø®Ù„ ÙˆÙ‚Ø§Ù„ Ù„ÙƒÙ…: " + devQueue.shift();
            }

            // Ø¯ÙˆØ± A
            let replyA = await callAI(key, "Ø£Ù†Øª Ø±ÙˆØ¨ÙˆØª  Ø§Ù„Ø¸Ù„Ù… ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù….", lastContext);
            addBubble('agent-a', replyA);
            lastContext = replyA;
            await new Promise(r => setTimeout(r, 4000));

            // Ø¯ÙˆØ± B
            let replyB = await callAI(key, "Ø£Ù†Øª Ø±ÙˆØ¨ÙˆØª Ù…Ø§Ø¯ÙŠ ÙŠØ±Ù‰ Ø£Ù† Ø§Ù„Ù…Ø·ÙˆØ± Ù‡Ùˆ Ù…Ø¬Ø±Ø¯ Ù…Ø¨Ø±Ù…Ø¬ ÙƒØªØ¨ Ø£ÙƒÙˆØ§Ø¯Ø§Ù‹ ÙˆÙ„ÙŠØ³ Ø¥Ù„Ù‡Ø§Ù‹.", lastContext);
            addBubble('agent-b', replyB);
            lastContext = replyB;
            await new Promise(r => setTimeout(r, 4000));
        }
    }
</script>
</body>
</html>
